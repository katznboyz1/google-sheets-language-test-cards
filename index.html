<!DOCTYPE html>
<html lang = 'en'>
    <head>
        <meta charset = 'utf-8'/>
        <meta content = 'Google Sheets Test Card Generator' property = 'og:title'/>
        <meta content = 'Test your language skills using your own Google Sheets, in flash card form!' property = 'og:site_name'/>
        <meta content = 'This site allows you to enter a Google Sheets URL, and then it generates test cards based on the content in the sheet.' property = 'og:description'/>
        <meta content = '#59fa4d' data-react-helpet = 'true' name = 'theme-color'/>

        <link rel = 'stylesheet' href = './utils/bootstrap-4.1.3.min.css'/>
        <link rel = 'stylesheet' href = './utils/index.html.css'/>

        <title>Google Sheets Test Card Generator</title>

        <script src = './utils/jquery-3.3.1.min.js'></script>
        <script src = './utils/popper-1.14.3.min.js'></script>
        <script src = './utils/bootstrap-4.1.3.min.js'></script>
        <script src = './utils/papaparse.min.js'></script>

        <script>
            const GOOGLE_SHEET_URL_ELEMENT_ID = 'google-sheet-url';

            let googleSheetData;

            function toggleLoadingScreen(status) {
                if (status) {
                    setTimeout(function() {document.getElementById('loading-overlay').style.display = 'inline-block';}, 200);
                } else {
                    setTimeout(function() {document.getElementById('loading-overlay').style.display = 'none';}, 200);
                }
            }

            function parseGoogleSheetURL() {

                // timeout so that the loading screen doesnt flash too fast
                let googleSheetURLUnparsed = document.getElementById(GOOGLE_SHEET_URL_ELEMENT_ID).value;

                $.ajax({
                    headers: {'Accept':'text/csv'},
                    type: 'GET',
                    url: 'https://docs.google.com/spreadsheets/d/' + String(googleSheetURLUnparsed) + '/export?format=csv',
                    crossDomain: true,
                    beforeSend: function(xhr) {
                        xhr.withCredentials = true;
                        console.log('DEBUG: SENDING REQUEST');
                        toggleLoadingScreen(true);

                    }, success: function(data, status, request) {
                        console.log('DEBUG: GOT RESPONSE');
                        googleSheetData = Papa.parse(data);
                        if (googleSheetData['errors'].length > 0) {
                            console.log('DEBUG: RESPONSE IS INVALID')
                            alert('Error parsing the spreadsheet.');
                        } else {
                            console.log('DEBUG: RESPONSE IS VALID');
                        }
                        toggleLoadingScreen(false);

                    }, error: function(request, status, error) {
                        console.log('DEBUG: REQUEST FAILED');
                        alert('Failed to download the Google Sheet. Please make sure that the ID you are using leads to a public Google Sheet.');
                        toggleLoadingScreen(false);
                    }
                })
            }
        </script>
    </head>
    <body>
        <div class = 'container-fluid mx-0' id = 'main-div'>
            <div class = 'row col-lg-12 mx-0'>
                <div class = 'd-flex col-lg-12 vh-100 justify-content-center big-divs'>
                    <div class = 'col-lg-12 form-horizontal my-auto'>
                        <div class = 'd-flex form-group col-lg-6 col-md-12 mx-auto'>
                            <h1 class = 'mx-auto center-text'>
                                Google Sheets Test Card Generator
                            </h1>
                        </div>
                        <div class = 'd-flex form-group col-lg-6 col-md-12 mx-auto header-margin-1'>
                            <h6 class = 'mx-auto center-text'>
                                written by <a href = 'https://github.com/katznboyz1' class = 'link-blue'>katznboyz</a>
                            </h6>
                        </div>
                        <div class = 'd-flex justify-content-between form-group col-lg-6 col-md-12 mx-auto'>
                            <span class = 'text-nowrap my-auto px-1'>
                                <p class = 'my-auto'>Google Sheet URL:</p>
                            </span>
                            <input type = 'text' id = 'google-sheet-url' class = 'form-control my-auto flex-grow-1' placeholder = 'Document ID (looks like aBcDefGHiJKlmnOPQrStUVwxYZ)'/>
                        </div>
                        <div class = 'd-flex form-group col-lg-6 col-md-12 mx-auto'>
                            <h6 class = 'mx-auto center-text'>
                                Please make sure that the Google Sheets URL you are using leads to a <b>public</b> Google Sheet. <span class = 'link-blue' data-toggle = 'collapse' href = '#collapsable-instruction-menu' role = 'button' aria-expanded = 'false' aria-controls = 'collapsable-instruction-menu'>(instructions)</span>
                            </h6>
                        </div>
                        <div class = 'd-flex form-group col-lg-6 col-md-12 mx-auto'>
                            <div class = 'collapse border border-secondary mx-auto col-lg-12' id = 'collapsable-instruction-menu'>
                                <p>Instructions for finding the Google Sheet ID (desktop):</p>
                                <ol>
                                    <li>Go to your Google Sheets document.</li>
                                    <li>Go to the top right corner and click <i>"Share"</i>.</li>
                                    <li>Make sure that <i>"Anyone on the internet with this link can view"</i> is selected, or else this website won't be able to access your sheet.</li>
                                    <li>Copy the link. You should have a link similar to <i>"https://docs.google.com/spreadsheets/d/aBcDefGHiJKlmnOPQrStUVwxYZ/edit?usp=sharing"</i>.</li>
                                    <li>Copy <b>only</b> the part of the link that has all the mixed case letters and numbers, then paste it into the searchbar on this website.</li>
                                    <li>Clicking the generate cards link should work now!</li>
                                </ol>
                            </div>
                        </div>
                        <div class = 'd-flex form-group col-lg-6 col-12-md mx-auto'>
                            <button class = 'btn btn-primary mx-auto' onclick = 'parseGoogleSheetURL();'>Verify Settings and Generate Cards Link</button>
                        </div>
                        <div class = 'd-flex justify-content-between form-group col-lg-2 col-md-4 mx-auto margin-top-a-little-bit'>
                            <span class = 'text-nowrap my-auto px-1'>
                                <p class = 'my-auto'><b>"Translate from"</b> row:</p>
                            </span>
                            <select class = 'btn btn-outline-dark'>
                                <option>1</option>
                                <option>2</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class = 'loading-overlay' id = 'loading-overlay'>
            <div class = 'container-fluid mx-0 col-lg-12 vh-100 d-flex align-items-center'>
                <h1 class = 'text-center col-lg-12'>
                    Downloading the spreadsheet...
                </h1>
            </div>
        </div>
    </body>
</html>